<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.medical.mapper.DoctorinfoMapperCustom" >
	<!-- 医生信息列表查询 -->
 	<select id="findDoctorInfoInList" parameterType="com.medical.po.DoctorSearch" 
  						resultType="map">
  		 SELECT	a.docloginid,e.docloginpix,a.docname,a.doctitle,a.dochosp,a.hosplevel,a.docprimarydept,a.docseconddept,
  					a.docallday,a.docexpert,
	  		     ROUND(
			        6378.138 * 2 * ASIN(
			            SQRT(
			                POW(
			                    SIN(
			                        (
			                        
			                           #{lat} * PI() / 180 - a.docHospLat * PI() / 180
			                        ) / 2
			                    ),
			                    2
			                ) + COS(#{lat} * PI() / 180) * COS(a.docHospLat * PI() / 180) * POW(
			                    SIN(
			                        (
			                            #{lon} * PI() / 180 - a.docHospLon * PI() / 180
			                        ) / 2
			                    ),
			                    2
			                )
			            )
			        ) * 1000
			    ) AS distance
  		   FROM doctorinfo as a 
  		   		left join  doctorskd as d on a.docLoginId = d.docLoginId 
  		   		left join doctorlogininfo as e on a.docLoginId = e.docLoginId 
  		   <where>
  		   		and e.docLoginType=1
	  		   <if test="province!=null">
	  		   	  and e.docLoginProvince=#{province}
	  		   </if>
	  		   <if test="city!=null">
	  		   	  and e.docLoginCity=#{city}
	  		   </if>
	  		   <if test="area!=null">
	  		   	  and e.docLoginArea=#{area}
	  		   </if>
	  		   <if test="primaryDept!=null">
	  		   	  and a.docPrimaryDept=#{primaryDept}
	  		   </if>
	  		   <if test="secondDept!=null">
	  		   	  and a.docSecondDept=#{secondDept}
	  		   </if>
	  		   <if test="time!=null">
	  		   	<if test="time==1">
	  		   	   and d.monAm=1
	  		   	</if>
	  		   	<if test="time==2">
	  		   	   and d.monPm=1
	  		   	</if>
	  		   	<if test="time==3">
	  		   	   and d.tueAm=1
	  		   	</if>
	  		   	<if test="time==4">
	  		   	   and d.tuePm=1
	  		   	</if>
	  		   	<if test="time==5">
	  		   	   and d.wedAm=1
	  		   	</if>
	  		   	<if test="time==6">
	  		   	   and d.wedPm=1
	  		   	</if>
	  		   	<if test="time==7">
	  		   	   and d.thuAm=1
	  		   	</if>
	  		   	<if test="time==8">
	  		   	  and d.thuPm=1
	  		   	</if>
	  		   	<if test="time==9">
	  		   	   and d.friAm=1
	  		   	</if>
	  		   	<if test="time==10">
	  		   	   and d.friPm=1
	  		   	</if>
	  		   	<if test="time==11">
	  		   	  and d.satAm=1
	  		   	</if>
	  		   	<if test="time==12">
	  		   	   and d.satPm=1
	  		   	</if>
	  		   	<if test="time==13">
	  		   	   and d.sunAm=1
	  		   	</if>
	  		   	<if test="time==14">
	  		   	   and d.sunPm=1
	  		   	</if>
	  		   </if>
	  		   
  		   </where>
  		   ORDER BY distance ASC
  	</select>
  	<select id="findDoctorInfoInListByLoc" parameterType="com.medical.po.DoctorSearch" 
  						resultType="map">
  		   SELECT a.docname,a.docmale,a.docage,a.doctitle,a.dochosp,a.docdept,a.docallday,a.docloginid,a.docexpert,a.docabs,a.hosplevel,
  		   e.docloginprovince,e.doclogincity,e.docloginarea,e.docloginother
	  		    
  		   FROM doctorinfo as a  
  		   		left join  doctorskd as d on a.docLoginId = d.docLoginId 
  		   		left join doctorlogininfo as e on a.docLoginId = e.docLoginId 
  		   where  e.docLoginType=1 
				<if test="province!=null">
	  		   	  and e.docLoginProvince=#{province}
	  		   </if>
	  		   <if test="city!=null">
	  		   	  and e.docLoginCity=#{city}
	  		   </if>
	  		   <if test="area!=null">
	  		   	  and e.docLoginArea=#{area}
	  		   </if>
	  		ORDER BY distance ASC
  		   limit #{pageNo},#{pageSize}; 
  	</select>
 	<!--医生信息地图模式  -->
  	<select id="findDoctorInfoInMap" parameterType="String" resultType="map">
  		   SELECT a.docloginid,b.docloginpix,a.dochosplat,a.dochosplon,a.docprimarydept,docseconddept
  		  
  		   FROM doctorinfo as a
  		   	  left join doctorlogininfo as b on a.docLoginId = b.docLoginId
  		   where  (a.docHospLat BETWEEN #{0} AND #{1}) AND (a.docHospLon BETWEEN #{2} AND #{3});
  	</select>
  	<select id="findDoctorinfoByDocLoginId" parameterType="java.lang.Integer" resultType="com.medical.po.Doctorinfo">
  			select * from doctorinfo where docLoginId = #{id}
  	</select>
   <!--查找单个医生详细信息  -->
  	<select id="findDoctorByDocLoginId" parameterType="java.lang.Integer" resultType="map">
  			select a.docloginid,b.docloginpix,a.docname,a.docmale,a.docage,a.doctitle,a.docexpert,a.docabs,a.docprimarydept,a.docseconddept,a.docallday,
  				a.dochosp,a.hosplevel,a.dochospprovince,a.dochospcity,a.dochosparea,a.dochospother
  			 from doctorinfo as a 
  				left join doctorlogininfo as b on a.docLoginId = b.docLoginId 
  			where a.docLoginId = #{id}
  	</select>
  	<select id="findDoctorByInfo" parameterType="com.medical.po.DoctorSearch" 
  						resultType="map">
  		   SELECT *
  		   FROM doctorinfo 
  		   <where>
	  		   <if test="province!=null">
	  		   	  and e.docLoginProvince=#{province}
	  		   </if>
	  		   <if test="city!=null">
	  		   	  and e.docLoginCity=#{city}
	  		   </if>
	  		   <if test="area!=null">
	  		   	  and e.docLoginArea=#{area}
	  		   </if>
  		   </where>
  		   ORDER BY docId ASC
  		   limit #{pageNo},#{pageSize}; 
  	</select>
  	<select id="selectFirstInfoByDocLoginId" parameterType="java.lang.Integer" resultType="map">
  			select docname,doccardnum,docmale,docage,dochosp,docdept,docallday
  			from doctorinfo where docLoginId = #{id}
  	</select>
  	<select id="selectSecondInfoByDocLoginId" parameterType="java.lang.Integer" resultType="map">
  			select doccardphoto,doctitlephoto,docqualphoto,docworkcardphoto,docotherphoto
  			from doctorinfo where docLoginId = #{id}
  	</select>
  	<select id="selectNameAndTitleByDocLoginId" parameterType="java.lang.Integer" resultType="map">
  			select a.docname,a.doctitle
  			from doctorinfo as a 
  			where docLoginId = #{id}
  	</select>
  	<select id="paginationDoctorList" parameterType="com.medical.po.HospSearchDocTerm"
  		 resultType="map">
  		   SELECT a.docloginid,a.docloginpix,a.docloginname,c.docallday,a.docloginphone,c.dochosp,c.docdept,c.docage,c.docmale,
  		   			c.doctitle,c.docname,c.docbirthdate,c.docnation,c.docexpert,c.docabs,
  		   			c.dochospprovince,c.dochospcity,c.dochosparea,c.dochospother,
  		   			b.monam,b.monpm,b.tueam,b.tuepm,b.wedam,b.wedpm,b.thuam,b.thupm,b.friam,b.fripm,b.satam,b.satpm,b.sunam,b.sunpm
  		   FROM doctorlogininfo as a 
  		   left join doctorskd as b on a.docLoginId=b.docLoginId 
  		   left join doctorinfo as c on a.docLoginId=c.docLoginId 
  		  
  		<!-- <where>
  			<if test="doctorTitle!=null"></if>
  			and d.docTitleId=#{doctorTitle}
  			<if test="hospitalLevel!=null"></if>
  			and c.hospLevelId=#{hospitalLevel}
  		</where> -->
  		<!-- ORDER BY doctorlogininfo.docLoginId -->
  		
  	</select>
  	<!-- 根据登录id查询医生个人信息 -->
  	<select id="selectByDocLoginId" parameterType="java.lang.Integer" resultType="com.medical.po.Doctorinfo">
  			select * from doctorinfo where docLoginId = #{0}
  	</select>
  </mapper>